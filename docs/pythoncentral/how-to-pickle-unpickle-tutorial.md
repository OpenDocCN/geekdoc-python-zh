# 如何腌制:腌制和拆洗教程

> 原文：<https://www.pythoncentral.io/how-to-pickle-unpickle-tutorial/>

## 先决条件

需要了解以下内容:

1.  Python 3
2.  字典等基本 Python 数据结构
3.  Python 中的文件操作

## 简介

字面意思， 泡菜 的意思是 在盐溶液中储存东西。只是在这里，它的对象不是蔬菜。并不是生活中的一切都可以看成 0 和 1(天哪！哲学)，但 pickling 帮助我们实现了这一点，因为它将任何类型的复杂数据转换为 0 和 1(字节流)。这个过程可以被称为酸洗、序列化、展平或编组。产生的字节流也可以通过一个称为拆包的过程转换回 Python 对象。

## 为什么是泡菜？

由于我们处理的是二进制，数据不是被写入而是被转储，同样，数据不是被读取，而是被加载。例如，当你玩一个像“戴夫”这样的游戏，并且你达到了一定的级别，你会想要保存它，对吗？如你所知，这个游戏有各种属性，比如健康，收集的宝石等等。所以当你保存你的游戏时，比方说在第 7 级，当你有一颗健康的心和 300 点时，一个对象是从一个具有这些值的 Dave 类创建的。 当你点击“保存”按钮时，该对象被序列化并保存，或者换句话说被腌制。不用说，当你恢复一个已保存的游戏时，你将会从它的 pickled 状态中加载数据，从而对它进行解包。

酸洗和拆洗在现实世界中应用广泛，因为它们可以让你轻松地将数据从一台服务器发送到另一台服务器，并将其存储在文件或数据库中。

警告: 不要从不可信的来源提取数据，因为这可能会带来严重的安全风险。Pickle 模块无法在 Pickle 恶意数据时知道或引发错误。

只有导入相应的模块酸洗，才能进行酸洗和拆洗。您可以使用下面的命令来完成这个任务:

```py
import pickle
```

## 工作中的泡菜

现在让我们看一个简单的例子来说明如何编写字典。

```py
import pickle
emp = {1:"A",2:"B",3:"C",4:"D",5:"E"}
pickling_on = open("Emp.pickle","wb")
pickle.dump(emp, pickling_on)
pickling_on.close()
```

请注意使用“wb”而不是“w ”,因为所有操作都是使用字节完成的。此时，您可以使用记事本打开当前工作目录中的 Emp.pickle 文件，并查看 pickle 数据的外观。

那么，既然数据已经被剔除，让我们来研究一下如何拆开这本字典。

```py
pickle_off = open("Emp.pickle","rb")
emp = pickle.load(pickle_off)
print(emp)
```

现在您将获得我们之前初始化的 employees 字典。当我们读取字节时，注意使用“rb”而不是“r”。这是一个很基础的例子，一定要自己多尝试。

如果您想获得一个包含酸洗数据的字节字符串，而不是 obj 的酸洗表示，那么您需要使用转储。类似地，要从字节流中读取对象的 pickled 表示，应该使用 loads。

## 数据流格式

数据流格式被称为协议，它规定了酸洗数据的输出格式。有几种可用的协议版本。您必须了解协议版本，以避免兼容性问题。

*   协议版本 0——原始的基于文本的格式，向后兼容早期版本的 Python。
*   协议版本 1——一种旧的二进制格式，也兼容早期版本的 Python。
*   协议第 2 版——在 Python 2.3 中引入，提供高效的类和实例选择，
*   协议版本 3——在 Python 3.0 中引入，但它不是向后兼容的。
*   协议版本 4 -在 Python 3.4 中添加。它增加了对非常大的对象的支持，支持更多种类的对象，以及一些数据格式优化。

注意，协议版本保存为 pickle 数据格式的一部分。但是，要在特定协议中解包数据，需要在使用 dump() 命令时指定数据。

要了解所使用的协议，在导入 pickle 库后使用以下命令。这将返回正在使用的最高协议。

```py
pickle.HIGHEST_PROTOCOL
```

## 异常情况

需要注意的一些常见例外:

1.  咸菜。PicklingError :当你试图 pickle 一个不支持 pickle 的对象时，这个异常被抛出。
2.  咸菜。UnpicklingError :当文件包含损坏的数据时引发该异常。
3.  EOFError :当检测到文件结束时引发该异常。

## 优势

1.  帮助保存复杂的数据。
2.  相当容易使用，不需要几行代码，因此不庞大。
3.  保存的数据不可读，因此提供了一些数据安全性。

## 缺点

1.  非 Python 程序可能无法重建腌制的 Python 对象。
2.  从恶意来源中提取数据的安全风险。

腌制被认为是一个高级话题，所以继续练习和学习掌握它。一定要去看看这些与腌制相关的有趣话题- [挑拣者](https://docs.python.org/3/library/pickle.html)、[去挑拣者](https://docs.python.org/3/library/pickle.html?highlight=unpickler#pickle.Unpickler)、[去挑拣者](https://docs.python.org/2.3/lib/module-cPickle.html)。快乐的蟒蛇！
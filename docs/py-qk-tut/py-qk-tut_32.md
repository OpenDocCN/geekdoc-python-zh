## Python 标准库 01 正则表达式 (re 包)

[`www.cnblogs.com/vamei/archive/2012/08/31/2661870.html`](http://www.cnblogs.com/vamei/archive/2012/08/31/2661870.html)

作者：Vamei 出处：http://www.cnblogs.com/vamei 欢迎转载，也请保留这段声明。谢谢！

我将从正则表达式开始讲 Python 的标准库。正则表达式是文字处理中常用的工具，而且不需要额外的系统知识或经验。我们会把系统相关的包放在后面讲解。

正则表达式(regular expression)主要功能是从字符串(string)中通过特定的模式(pattern)，搜索想要找到的内容。

1\. 正则表达式语法

之前，我们简介了[字符串相关的处理函数](http://www.cnblogs.com/vamei/archive/2012/07/19/2599940.html)。我们可以通过这些函数实现简单的搜索功能，比如说从字符串“I love you”中搜索是否有“you”这一子字符串。但有些时候，我们只是模糊地知道我们想要找什么，而不能具体说出我是在找“you”，比如说，我想找出字符串中包含的数字，这些数字可以是 0 到 9 中的任何一个。这些模糊的目标可以作为信息写入正则表达式，传递给 Python，从而让 Python 知道我们想要找的是什么。

([官方 documentation](http://docs.python.org/library/re.html))

在 Python 中使用正则表达式需要标准库中的一个包 re。

```py
import re
m = re.search('[0-9]','abcd4ef') print(m.group(0))

```

re.search()接收两个参数，第一个'[0-9]'就是我们所说的正则表达式，它告诉 Python 的是，“听着，我从字符串想要找的是从 0 到 9 的一个数字字符”。

re.search()如果从第二个参数找到符合要求的子字符串，就返回一个对象 m，你可以通过 m.group()的方法查看搜索到的结果。如果没有找到符合要求的字符，re.search()会返回 None。

如果你熟悉 Linux 或者 Perl, 你应该已经熟悉正则表达式。当我们打开 Linux shell 的时候，可以用正则表达式去查找或着删除我们想要的文件，比如说：

$rm book[0-9][0-9].txt

这就是要删除类似于 book02.txt 的文件。book[0-9][0-9].txt 所包含的信息是，以 book 开头，后面跟两个数字字符，之后跟有".txt"的文件名。如果不符合条件的文件名，比如说:

bo12.txt

book1.txt

book99.text

都不会被选中。

Perl 中内建有正则表达式的功能，据说是所有正则表达式系统中最强的，这也是 Perl 成为系统管理员利器的一个原因。

2\. 正则表达式的函数

```py
m = re.search(pattern, string)  # 搜索整个字符串，直到发现符合的子字符串。
m = re.match(pattern, string)   # 从头开始检查字符串是否符合正则表达式。必须从字符串的第一个字符开始就相符。

```

可以从这两个函数中选择一个进行搜索。上面的例子中，我们如果使用 re.match()的话，则会得到 None，因为字符串的起始为‘a’， 不符合'[0-9]'的要求。

对于返回的 m, 我们使用 m.group()来调用结果。（我们会在后面更详细解释 m.group()）

我们还可以在搜索之后将搜索到的子字符串进行替换：

```py
str = re.sub(pattern, replacement, string) 
# 在 string 中利用正则变换 pattern 进行搜索，对于搜索到的字符串，用另一字符串 replacement 替换。返回替换后的字符串。

```

此外，常用的正则表达式函数还有

re.split()    # 根据正则表达式分割字符串， 将分割后的所有子字符串放在一个表(list)中返回

re.findall()  # 根据正则表达式搜索字符串，将所有符合的子字符串放在一给表(list)中返回

(在熟悉了上面的函数后，可以看一下 re.compile()，以便于提高搜索效率。)

3\. 写一个正则表达式

关键在于将信息写成一个正则表达式。我们先看正则表达式的常用语法：

1）单个字符:

.          任意的一个字符

a|b        字符 a 或字符 b

[afg]      a 或者 f 或者 g 的一个字符        

[0-4]      0-4 范围内的一个字符

[a-f]      a-f 范围内的一个字符

[^m]       不是 m 的一个字符

\s         一个空格 

\S         一个非空格 

\d         [0-9] 

\D         [⁰-9] 

\w         [0-9a-zA-Z] 

\W         [⁰-9a-zA-Z] 

2）重复

紧跟在单个字符之后，表示多个这样类似的字符

*         重复 >=0 次

+         重复 >=1 次

?         重复 0 或者 1 次

{m}       重复 m 次。比如说 a{4}相当于 aaaa，再比如说[1-3]{2}相当于[1-3][1-3]

{m, n}    重复 m 到 n 次。比如说 a{2, 5}表示 a 重复 2 到 5 次。小于 m 次的重复，或者大于 n 次的重复都不符合条件。

正则表达          相符的字符串举例

[0-9]{3,5}       9678

a?b              b

a+b              aaaaab

3) 位置

^         字符串的起始位置

$         字符串的结尾位置

正则表达          相符的字符串举例        不相符字符串 

^ab.*c$          abeec               cabeec (如果用 re.search(), 将无法找到。) 

 4）返回控制

我们有可能对搜索的结果进行进一步精简信息。比如下面一个正则表达式： 

output_(\d{4}) 

该正则表达式用括号()包围了一个小的正则表达式，\d{4}。 这个小的正则表达式被用于从结果中筛选想要的信息（在这里是四位数字）。这样被括号圈起来的正则表达式的一部分，称为群(group)。
我们可以 m.group(number)的方法来查询群。group(0)是整个正则表达的搜索结果，group(1)是第一个群…… 

```py
import re
m = re.search("output_(\d{4})", "output_1986.txt") print(m.group(1))

```

我们还可以将群命名，以便更好地使用 m.group 查询:

```py
import re
m = re.search("output_(?P<year>\d{4})", "output_1986.txt")   #(?P<name>...) 为 group 命名
print(m.group("year"))

```

4\. 练习
有一个文件，文件名为 output_1981.10.21.txt 。下面使用 Python： 读取文件名中的日期时间信息，并找出这一天是周几。将文件改名为 output_YYYY-MM-DD-W.txt (YYYY:四位的年，MM：两位的月份，DD：两位的日，W：一位的周几，并假设周一为一周第一天)

总结：

re.search() re.match() re.sub() re.findall()

正则表达式构成方法